version: "2"
#if needed to map the orthancPACS to a different hard disk device (after mounting it in path)
# volumes: ["/home/petctviewer/orthanc:/var/lib/orthanc/db:Z"]
services:
    orthancexposed:
        build: orthancexposed
        restart: unless-stopped
        ports: ["8043:8042"]
        volumes: ["storageexposed:/var/lib/orthanc/db:Z"]
        environment:
            TRANSFERS_BUNDLE_DEFAULTS: "true"
            NAME: OrthancExposed
            PEERS: |
                {
                    "OrthancPacs": ["http://orthancpacs:8042/", "GaelO", "GaelO"]
                }
    orthancpacs:
        build: orthancpacs
        depends_on: [index]
        restart: unless-stopped
        ports: ["127.0.0.1:8042:8042"]
        volumes: ["storagepacs:/var/lib/orthanc/db:Z"]
        environment:
            DW_ENABLED: "true"
            TRANSFERS_BUNDLE_DEFAULTS: "true"
            NAME: OrthancPacs 
            MYSQL_HOST: index
            MYSQL_USER: orthancPacs
            MYSQL_DB: orthancPacs
            MYSQL_PASSWORD: sassa
    index:
            image: mysql:8.0
            command: [mysqld, --default-authentication-plugin=mysql_native_password, --log-bin-trust-function-creators=1]
            volumes: ["index:/var/lib/mysql:Z"]
            environment:
                    MYSQL_ENABLED: "true" 
                    MYSQL_PASSWORD: sassa
                    MYSQL_USER: orthancPacs
                    MYSQL_DATABASE: orthancPacs
                    MYSQL_ROOT_PASSWORD: foo-root
            restart: unless-stopped

volumes:
        storageexposed:
        storagepacs:
        index:
